# 996.icu-bundle-base64

decrypt.js

```javascript
const fs = require('fs')
const path = require('path')

const base64 = v => Buffer.from(v).toString('base64')
const pathReplace = string => string.replace(/\//g, ':')

const work = map => {
  let base64Map = map.map(base64).map(pathReplace)

  let here = path.join(...map)
  let there = path.join(...base64Map)

  let stat = fs.statSync(here)

  if (stat.isFile()) {
    console.log('file', here)
    console.log('file64', there)
    fs.writeFileSync(there, base64(fs.readFileSync(here)))
  }

  if (stat.isDirectory() && !map.includes('.git')) {
    console.log('dir', here)
    console.log('dir64', there)
    try {
      fs.mkdirSync(there)
    } catch {}

    let dir = fs.readdirSync(here)
    for (let i = 0; i < dir.length; i++) {
      work([...map, dir[i]])
    }
  }
}

work(['996.icu-bundle'])

```



encrypt.js

```javascript
const fs = require('fs')
const path = require('path')

const base64 = v => Buffer.from(v).toString('base64')
const pathReplace = string => string.replace(/\//g, ':')

const work = map => {
  let base64Map = map.map(base64).map(pathReplace)

  let here = path.join(...map)
  let there = path.join(...base64Map)

  let stat = fs.statSync(here)

  if (stat.isFile()) {
    console.log('file', here)
    console.log('file64', there)
    fs.writeFileSync(there, base64(fs.readFileSync(here)))
  }

  if (stat.isDirectory() && !map.includes('.git')) {
    console.log('dir', here)
    console.log('dir64', there)
    try {
      fs.mkdirSync(there)
    } catch {}

    let dir = fs.readdirSync(here)
    for (let i = 0; i < dir.length; i++) {
      work([...map, dir[i]])
    }
  }
}

work(['996.icu-bundle'])

```